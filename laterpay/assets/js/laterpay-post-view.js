!function(e){e(function(){function t(){var t={body:e("body"),previewModePlaceholder:e("#lp_js_previewModePlaceholder"),previewModeContainer:"#lp_js_previewModeContainer",previewModeForm:"#lp_js_previewModeForm",previewModeToggle:"#lp_js_togglePreviewMode",previewModeInput:"#lp_js_previewModeInput",previewModeVisibilityForm:"#lp_js_previewModeVisibilityForm",previewModeVisibilityToggle:"#lp_js_togglePreviewModeVisibility",previewModeVisibilityInput:"#lp_js_previewModeVisibilityInput",optionContainer:".lp_purchase-overlay-option",optionInput:".lp_purchase-overlay-option__input",submitButtonText:".lp_purchase-overlay__submit-text",timePass:".lp_js_timePass",flipTimePassLink:".lp_js_flipTimePass",timePassPreviewPrice:".lp_js_timePassPreviewPrice",voucherCodeWrapper:"#lp_js_voucherCodeWrapper",voucherCodeInput:".lp_js_voucherCodeInput",voucherRedeemButton:".lp_js_voucherRedeemButton",giftCardRedeemButton:".lp_js_giftCardRedeemButton",giftCardCodeInput:".lp_js_giftCardCodeInput",giftCardWrapper:"#lp_js_giftCardWrapper",giftCardActionsPlaceholder:".lp_js_giftCardActionsPlaceholder",giftsWrapper:e(".lp_js_giftsWrapper"),subscription:".lp_js_subscription",flipSubscriptionLink:".lp_js_flipSubscription",postContentPlaceholder:e("#lp_js_postContentPlaceholder"),postRatingPlaceholder:e("#lp_js_postRatingPlaceholder"),purchaseLink:".lp_js_doPurchase",purchaseOverlay:".lp_js_overlayPurchase",currentOverlay:'input[name="lp_purchase-overlay-option"]:checked',postRatingForm:e(".lp_js_ratingForm"),postRatingRadio:e("input[type=radio][name=rating_value]"),hidden:"lp_is-hidden",fadingOut:"lp_is-fading-out",premiumBox:".lp_js_premium-file-box",redeemVoucherBlock:e(".lp_purchase-overlay__voucher"),notificationButtons:e(".lp_js_notificationButtons"),notificationCancel:e(".lp_js_notificationCancel"),voucherCancel:".lp_js_voucherCancel",redeemVoucherButton:".lp_js_redeemVoucher",overlayMessageContainer:".lp_js_purchaseOverlayMessageContainer",overlayTimePassPrice:".lp_js_timePassPrice"},i=function(e){return'<div id="lp_js_voucherCodeFeedbackMessage" class="lp_voucher__feedback-message" style="display:none;">'+e+"</div>"},o=function(e){return'<div id="lp_js_voucherCodeFeedbackMessage" class="lp_purchase-overlay__voucher-error">'+e+"</div>"},a=function(){t.postRatingForm=e(".lp_js_ratingForm"),t.postRatingRadio=e("input[type=radio][name=rating_value]")},n=function(){t.previewModeContainer=e("#lp_js_previewModeContainer"),t.previewModeForm=e("#lp_js_previewModeForm"),t.previewModeToggle=e("#lp_js_togglePreviewMode"),t.previewModeInput=e("#lp_js_previewModeInput"),t.previewModeVisibilityForm=e("#lp_js_previewModeVisibilityForm"),t.previewModeVisibilityToggle=e("#lp_js_togglePreviewModeVisibility"),t.previewModeVisibilityInput=e("#lp_js_previewModeVisibilityInput")},r=function(){t.previewModeToggle.on("change",function(){y()}),t.previewModeVisibilityToggle.on("mousedown",function(){w()}).on("click",function(e){e.preventDefault()})},s=function(){t.body.on("mousedown",t.purchaseLink,function(){j(this)}).on("click",t.purchaseLink,function(t){t.preventDefault(),e(this).data("preview-post-as-visitor")?alert(lpVars.i18n.alert):window.location.href=e(this).data("laterpay")}),t.body.on("mousedown",t.purchaseOverlay,function(){j(this)}).on("click",t.purchaseOverlay,function(t){t.preventDefault(),e(this).data("preview-post-as-visitor")?alert(lpVars.i18n.alert):l(e(this).attr("data-purchase-action"))}),t.body.on("click",t.optionContainer,function(i){switch(i.preventDefault(),e(this).find(t.optionInput).attr("checked","checked"),e(this).data("revenue")){case"sis":e(t.submitButtonText).text(lpVars.i18n.revenue.sis);break;case"sub":e(t.submitButtonText).text(lpVars.i18n.revenue.sub);break;case"ppu":default:e(t.submitButtonText).text(lpVars.i18n.revenue.ppu)}}),t.body.on("click",t.redeemVoucherButton,function(i){i.preventDefault(),t.redeemVoucherBlock.removeClass("lp_hidden"),t.notificationButtons.addClass("lp_hidden"),t.notificationCancel.removeClass("lp_hidden"),e(t.purchaseOverlay).find('[data-buy-label="true"]').addClass("lp_hidden"),e(t.purchaseOverlay).find('[data-voucher-label="true"]').removeClass("lp_hidden"),e(t.purchaseOverlay).attr("data-purchase-action","voucher")}),t.body.on("click",t.voucherCancel,function(i){i.preventDefault(),t.redeemVoucherBlock.addClass("lp_hidden"),t.notificationButtons.removeClass("lp_hidden"),t.notificationCancel.addClass("lp_hidden"),e(t.purchaseOverlay).find('[data-buy-label="true"]').removeClass("lp_hidden"),e(t.purchaseOverlay).find('[data-voucher-label="true"]').addClass("lp_hidden"),e(t.purchaseOverlay).attr("data-purchase-action","buy")}),t.body.on("click",t.flipTimePassLink,function(e){e.preventDefault(),M(this)}),t.body.on("click",t.flipSubscriptionLink,function(e){e.preventDefault(),M(this)})},l=function(i){return"buy"===i&&(window.location.href=e(t.currentOverlay).val()),"voucher"===i&&(e(t.overlayMessageContainer).html(""),d(e(t.overlayMessageContainer),o,t.voucherCodeInput,"purchase-overlay",!1)),!1},p=function(){t.postRatingRadio.on("change",function(){h()})},c=function(){e(t.voucherRedeemButton).on("mousedown",function(){d(e(this).parent(),i,t.voucherCodeInput,"time-pass",!1)}).on("click",function(e){e.preventDefault()}),e(t.giftCardRedeemButton).on("mousedown",function(){d(e(this).parent(),i,t.giftCardCodeInput,"time-pass",!0)}).on("click",function(e){e.preventDefault()})},d=function(i,o,a,n,r){var s=e(a).val();6===s.length?e.get(lpVars.ajaxUrl,{action:"laterpay_redeem_voucher_code",code:s,link:window.location.href},function(l){if(e(a).val(""),l.success)if(r)e("#fakebtn").attr("data-laterpay",l.url).click();else{var p,c=!1;e(t.timePass).each(function(){if(p=e(this).data("pass-id"),p===l.pass_id)return c=!0,!1}),c?window.location.href=l.url:u(s+lpVars.i18n.invalidVoucher,o,n,i)}else u(s+lpVars.i18n.invalidVoucher,o,n,i)},"json"):u(lpVars.i18n.codeTooShort,o,n,i)},u=function(t,i,o,a){var n=i(t);"purchase-overlay"===o&&a.html(n),"time-pass"===o&&(a.prepend(n),n=e("#lp_js_voucherCodeFeedbackMessage",a),n.fadeIn(250).click(function(){_(n)}),setTimeout(function(){_(n)},3e3))},_=function(e){e.fadeOut(250,function(){e.unbind().remove()})},h=function(){e.post(lpVars.ajaxUrl,t.postRatingForm.serializeArray(),function(i){i.success&&(e(".lp_rating",t.postRatingForm).addClass(t.fadingOut).html(i.message),setTimeout(function(){t.postRatingForm.fadeOut(400,function(){e(this).remove()})},4e3))},"json")},v=function(){e.get(lpVars.ajaxUrl,{action:"laterpay_post_rating_summary",post_id:lpVars.post_id},function(e){e&&t.postRatingPlaceholder.html(e)})},f=function(){var i=[],o=t.giftsWrapper;e.each(o,function(t){i.push(e(o[t]).data("id"))}),e.get(lpVars.ajaxUrl,{action:"laterpay_get_gift_card_actions",pass_id:i,link:window.location.href},function(i){i.data&&(e.each(i.data,function(o){var a=i.data[o],n=e(t.giftCardActionsPlaceholder+"_"+a.id);n.html(a.html),a.buy_more&&e(a.buy_more).appendTo(n.parent()).attr("href",window.location.href)}),V("laterpay_purchased_gift_card"))},"json")},m=function(){var i=[],o=[],a=e(t.premiumBox);e.each(a,function(t){i.push(e(a[t]).data("post-id")),o.push(e(a[t]).data("content-type"))}),e.get(lpVars.ajaxUrl,{action:"laterpay_get_premium_shortcode_link",ids:i,types:o,post_id:lpVars.post_id},function(t){if(t.data){var i=null;e.each(t.data,function(o){i=t.data[o],e.each(a,function(t){e(a[t]).data("post-id").toString()===o&&e(a[t]).prepend(i)})})}b()},"json")},g=function(){e.get(lpVars.ajaxUrl,{action:"laterpay_preview_mode_render",post_id:lpVars.post_id},function(e){e&&(t.previewModePlaceholder.before(e).remove(),n(),r())})},y=function(){t.previewModeToggle.prop("checked")?t.previewModeInput.val(1):t.previewModeInput.val(0),e.post(lpVars.ajaxUrl,t.previewModeForm.serializeArray(),function(){window.location.reload()})},w=function(){var i=t.previewModeContainer.hasClass(t.hidden)?"0":"1";t.previewModeVisibilityInput.val(i),t.previewModeContainer.toggleClass(t.hidden),e.post(lpVars.ajaxUrl,t.previewModeVisibilityForm.serializeArray())},C=function(){e.get(lpVars.ajaxUrl,{action:"laterpay_post_load_purchased_content",post_id:lpVars.post_id},function(i){i&&(t.postContentPlaceholder.html(i),a(),p(),e(t.premiumBox).length>=1&&m())})},j=function(t){e(t).data("preview-as-visitor")&&!e(t).data("is-in-visible-test-mode")&&alert(lpVars.i18n.alert)},b=function(){var e=k("laterpay_download_attached");e&&(V("laterpay_download_attached"),window.location.href=e)},M=function(t){e(t).parents(".lp_time-pass").toggleClass("lp_is-flipped")},V=function(e){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/"},k=function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},P=function(){1===t.postContentPlaceholder.length&&C(),1===t.previewModePlaceholder.length&&g(),1===t.postRatingPlaceholder.length&&v(),t.giftsWrapper.length>=1&&f(),e(t.premiumBox).length>=1&&m(),s(),p(),c()};P()}t()})}(jQuery);
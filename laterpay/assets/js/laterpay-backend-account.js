!function(e){e(function(){function t(){var t={apiKeyInput:e(".lp_js_validateApiKey"),merchantIdInput:e(".lp_js_validateMerchantId"),apiCredentialsInputs:e(".lp_js_validateApiKey, .lp_js_validateMerchantId"),testMerchantId:e("#lp_js_sandboxMerchantId"),testApiKey:e("#lp_js_sandboxApiKey"),liveMerchantId:e("#lp_js_liveMerchantId"),liveApiKey:e("#lp_js_liveApiKey"),pluginModeIndicator:e("#lp_js_pluginModeIndicator"),pluginModeToggle:e("#lp_js_togglePluginMode"),pluginVisibilitySetting:e("#lp_js_pluginVisibilitySetting"),pluginVisibilityToggle:e("#lp_js_toggleVisibilityInTestMode"),hasInvalidSandboxCredentials:e("#lp_js_hasInvalidSandboxCredentials"),isLive:"lp_is-live",navigation:e(".lp_navigation"),region:e("#lp_js_apiRegionSection"),regionNoticeBlock:e("#lp_js_regionNotice"),showMerchantContractsButton:e("#lp_js_showMerchantContracts"),apiCredentials:e("#lp_js_apiCredentialsSection"),requestSent:!1},i=t.region.val(),n=function(){t.apiKeyInput.bind("input",function(){var e=this;setTimeout(function(){c(e)},50)}),t.merchantIdInput.bind("input",function(){var e=this;setTimeout(function(){p(e)},50)}),t.region.change(function(){r()}),t.pluginModeToggle.change(function(){s()}),t.pluginVisibilityToggle.change(function(){l()}),window.onbeforeunload=function(){v()},t.showMerchantContractsButton.mousedown(function(){g()}).click(function(e){e.preventDefault()})},a=function(){for(var e=0,i=t.apiCredentialsInputs.length;e<i;e++)if(""===t.apiCredentialsInputs.eq(e).val())return void t.apiCredentialsInputs.eq(e).focus()},l=function(){u()?(t.hasInvalidSandboxCredentials.val(1),t.pluginVisibilityToggle.prop("checked",!1),t.testMerchantId.focus(),t.showMerchantContractsButton.velocity("fadeIn",{duration:250}),t.requestSent=!1):t.hasInvalidSandboxCredentials.val(0),d("laterpay_test_mode")},o=function(i){"live"===i?(e("#lp_js_pluginModeIndicator").velocity("fadeOut",{duration:250}),e("#lp_js_liveCredentials").addClass(t.isLive)):(e("#lp_js_pluginModeIndicator").velocity("fadeIn",{duration:250}),e("#lp_js_liveCredentials").removeClass(t.isLive))},s=function(){var e=t.pluginModeToggle,i=e.prop("checked");u()?(e.prop("checked",!1),t.liveMerchantId.focus(),t.requestSent=!1,t.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"})):i?(t.pluginVisibilitySetting.velocity("fadeOut",{duration:250}),t.showMerchantContractsButton.velocity("fadeOut",{duration:250})):t.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"}),d("laterpay_plugin_mode")},r=function(){var n="laterpay_region";e.post(ajaxurl,e("#"+n).serializeArray(),function(e){t.navigation.showMessage(e),e.success?(i=t.region.val(),t.testMerchantId.val(e.creds.cp_key),t.testApiKey.val(e.creds.api_key),"us"!==i?t.regionNoticeBlock.removeClass("hidden"):t.regionNoticeBlock.addClass("hidden")):t.region.val(i)},"json")},d=function(i){t.requestSent||(t.requestSent=!0,e.post(ajaxurl,e("#"+i).serializeArray(),function(e){t.navigation.showMessage(e),o(e.mode)},"json").done(function(){t.requestSent=!1}))},c=function(i){var n=e(i),a=n.parents("form"),o=n.val().trim(),r=32;if(o.length!==n.val().length&&n.val(o),0===o.length||o.length===r)d(a.attr("id"));else{t.navigation.showMessage(lpVars.i18nApiKeyInvalid,!1);var c=t.testApiKey.parents("form").attr("id");a.attr("id")===c&&l()}u()&&s()},p=function(i){var n=e(i),a=n.parents("form"),o=n.val().trim(),r=22;if(o.length!==n.val().length&&n.val(o),0===o.length||o.length===r)d(a.attr("id"));else{t.navigation.showMessage(lpVars.i18nMerchantIdInvalid,!1);var c=t.testMerchantId.parents("form").attr("id");a.attr("id")===c&&l()}u()&&s()},u=function(){var e=32!==t.liveApiKey.val().length||22!==t.liveMerchantId.val().length;return t.pluginModeToggle.prop("checked")&&e},g=function(){var i,n,a="https://www.laterpay.net/form/",l=parseInt(e(window).height(),10),o=parseInt(e("#wpadminbar").height(),10)+26,s=l-o,r=e('<div id="lp_js_legalDocsIframe" class="lp_legal-docs-iframe" style="height:'+s+'px;"></div>'),d=e("#lp_js_legalDocsIframe");t.showMerchantContractsButton.velocity("fadeOut",{duration:250}),0!==e("iframe",d).length&&e("iframe",d).remove(),0===d.length&&t.apiCredentials.after(r.velocity("slideDown",{duration:400,easing:"ease-out",complete:function(){i=e("#lp_js_legalDocsIframe").offset(),n=i.top-o,e("BODY, HTML").velocity("scroll",{duration:400,easing:"ease-out",offset:n})}})),d=e("#lp_js_legalDocsIframe"),d.html('<a href="#" id="lp_js_hideMerchantContracts" class="lp_legal-docs-iframe__close-link">x</a><iframe src="'+a+'" frameborder="0" height="'+s+'" width="100%"></iframe>'),e("#lp_js_hideMerchantContracts",d).bind("mousedown",function(){e(this).velocity("fadeOut",{duration:200}).parent("#lp_js_legalDocsIframe").velocity("slideUp",{duration:400,easing:"ease-out",complete:function(){e(this).remove()}}),t.showMerchantContractsButton.velocity("fadeIn",{duration:250,delay:250,display:"inline-block"})}).bind("click",function(e){e.preventDefault()})},v=function(){if(u())return lpVars.i18nPreventUnload},h=function(){n(),a()};h()}t()})}(jQuery);